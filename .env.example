# ============================================================================
# Fabric LA Connector - Environment Configuration
# ============================================================================
# This is the master environment configuration file for both:
# - Main FabricLA Connector (notebooks/)
# - Fabric Tenant Governance (fabric-governance/)
#
# SETUP INSTRUCTIONS:
# 1. Copy this file to .env in the root folder:
#    cp .env.example .env
#
# 2. Copy .env to your working directories:
#    cp .env notebooks/.env
#    cp .env fabric-governance/.env
#
# 3. Fill in your actual values in each .env file
#
# NEVER commit .env files to version control!
# Fabric Runtime: 1.3
# ============================================================================

# ================================
# Azure AD App Registration (Required)
# ================================
FABRIC_TENANT_ID=your-tenant-id-here
FABRIC_APP_ID=your-app-id-here
FABRIC_APP_SECRET=your-app-secret-here

# ================================
# Azure Subscription & Resources
# ================================
AZURE_TENANT_ID=your-tenant-id-here
AZURE_SUBSCRIPTION_ID=your-subscription-id-here
AZURE_RESOURCE_GROUP=fabric-monitoring-rg

# ================================
# Fabric Workspace Configuration
# ================================
FABRIC_WORKSPACE_ID=your-workspace-id-here
FABRIC_WORKSPACE_NAME=YourWorkspaceName
FABRIC_RUNTIME_VERSION=1.3
FABRIC_LAKEHOUSE_ID=your-lakehouse-id-here

# Capacity IDs (comma-separated for monitoring multiple capacities)
FABRIC_CAPACITY_IDS=capacity-guid-1,capacity-guid-2
FABRIC_TEST_CAPACITY_ID=your-test-capacity-id
FABRIC_PROD_CAPACITY_ID=your-prod-capacity-id

# ================================
# Azure Monitor Ingestion Configuration
# ================================
# Get these values from Terraform/Bicep deployment outputs

# Data Collection Endpoint (DCE) - Full URL
AZURE_MONITOR_DCE_ENDPOINT=https://dce-fabric-monitoring-xxxx.region-1.ingest.monitor.azure.com

# Data Collection Rule (DCR) - Immutable ID
AZURE_MONITOR_DCR_IMMUTABLE_ID=dcr-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Log Analytics Workspace
LOG_ANALYTICS_WORKSPACE_ID=your-workspace-id-here
LOG_ANALYTICS_WORKSPACE_NAME=law-fabric-monitoring
LOG_ANALYTICS_RESOURCE_GROUP=rg-fabric-monitoring

# ================================
# Stream Names - Main Monitoring (notebooks/)
# ================================
# Must match DCR configuration for Spark/Pipeline monitoring
AZURE_MONITOR_STREAM_LIVY_SESSION=Custom-FabricSparkLivySession_CL
AZURE_MONITOR_STREAM_SPARK_LOGS=Custom-FabricSparkLogs_CL
AZURE_MONITOR_STREAM_HISTORY_METRICS=Custom-FabricSparkHistoryMetrics_CL
AZURE_MONITOR_STREAM_RESOURCE_USAGE=Custom-FabricSparkResourceUsage_CL

# ================================
# Stream Names - Tenant Governance (fabric-governance/)
# ================================
# Must match DCR configuration in fabric-governance/common/dcr-template.json
AZURE_MONITOR_STREAM_NAME=Custom-FabricTenantSettings_CL
AZURE_MONITOR_STREAM_TENANT_SETTINGS=Custom-FabricTenantSettings_CL
AZURE_MONITOR_STREAM_PREVIEW_FEATURES=Custom-FabricPreviewFeatures_CL
AZURE_MONITOR_STREAM_GOVERNANCE_EVENTS=Custom-FabricGovernanceEvents_CL
AZURE_MONITOR_STREAM_ENVIRONMENT_COMPARISON=Custom-FabricEnvironmentComparison_CL

# ================================
# Key Vault Configuration (Optional)
# ================================
AZURE_KEY_VAULT_URI=https://your-keyvault-name.vault.azure.net/
AZURE_KEY_VAULT_SECRET_NAME=FabricServicePrincipal

# ================================
# Environment Identification (Governance)
# ================================
ENVIRONMENT_NAME=production

# ================================
# Security Groups (Optional - Governance)
# ================================
PREVIEW_TESTERS_GROUP_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
PROD_ADMINS_GROUP_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# ================================
# Notification Configuration (Optional)
# ================================
ALERT_WEBHOOK_URL=https://your-webhook-url
ALERT_EMAIL_ADDRESSES=admin1@company.com,admin2@company.com
TEAMS_WEBHOOK_URL=https://your-teams-webhook

# ================================
# Governance Configuration (fabric-governance/)
# ================================
APPROVED_PREVIEWS_FILE=./config/approved-previews.json
BASELINE_SETTINGS_FILE=./baseline/prod-tenant-settings.json

# ================================
# Monitoring Configuration
# ================================
MONITORING_SCHEDULE=Daily
ALERT_ON_NEW_PREVIEWS=true
ALERT_ON_SETTING_CHANGES=true
FAIL_ON_DRIFT=true

# ================================
# Collection Configuration
# ================================
FABRIC_LOOKBACK_HOURS=24
FABRIC_COLLECT_ACTIVITY_RUNS=true
FABRIC_METRICS_INTERVAL_MINUTES=15

# ================================
# Authentication Method
# ================================
# Options: AzureCLI, ManagedIdentity, ServicePrincipal
AUTH_METHOD=AzureCLI

# Service Principal Configuration (if using ServicePrincipal auth)
# AZURE_CLIENT_ID=your-service-principal-client-id
# AZURE_CLIENT_SECRET=your-service-principal-secret

# ================================
# Development & Debugging
# ================================
DEBUG_MODE=false
VERBOSE_LOGGING=false
LOG_LEVEL=INFO
LOG_FILE_PATH=./logs/monitoring.log

# ============================================================================
# QUICK SETUP GUIDE
# ============================================================================
#
# FOR MAIN MONITORING (notebooks/):
# ----------------------------------
# 1. Deploy infrastructure:
#    cd infra/terraform
#    terraform apply
#
# 2. Get Terraform outputs:
#    terraform output -json
#
# 3. Copy this file to notebooks folder:
#    cp .env.example .env
#    cp .env notebooks/.env
#
# 4. Update notebooks/.env with deployment outputs
#
# 5. Authenticate with Azure:
#    az login
#
# 6. Test: Open notebooks/validate_environment.ipynb and run all cells
#
# FOR TENANT GOVERNANCE (fabric-governance/):
# -------------------------------------------
# 1. Deploy infrastructure (choose one):
#    Bicep:     cd fabric-governance/bicep && deploy-infrastructure.bat
#    Terraform: cd fabric-governance/terraform && terraform apply
#
# 2. Get deployment outputs
#
# 3. Copy this file to fabric-governance folder:
#    cp .env fabric-governance/.env
#
# 4. Update fabric-governance/.env with deployment outputs
#
# 5. Authenticate with Azure:
#    az login
#
# 6. Test: Open fabric-governance/notebooks/fabric_tenant_settings_monitor.ipynb
#
# REQUIRED VALUES TO UPDATE:
# --------------------------
# - FABRIC_TENANT_ID, FABRIC_APP_ID, FABRIC_APP_SECRET
# - AZURE_TENANT_ID, AZURE_SUBSCRIPTION_ID
# - AZURE_MONITOR_DCE_ENDPOINT, AZURE_MONITOR_DCR_IMMUTABLE_ID
# - LOG_ANALYTICS_WORKSPACE_ID, LOG_ANALYTICS_WORKSPACE_NAME
# - FABRIC_WORKSPACE_ID (for main monitoring)
# - FABRIC_LAKEHOUSE_ID (for main monitoring)
#
# ============================================================================
